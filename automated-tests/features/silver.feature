Feature: Ingestion to silver layer

  Scenario: Ingesting data from bronze using block date
    Given there is bronze layer data at path '/bronze/eth_transfers_data/block_date=2024-11-23/data.csv':
      |blockchain	|block_date	|block_time	                |tx_hash	                                                        |token_category	|safe_sender	                            |receiver	                                |receiver_type	| event_name	|symbol	|token_address	                            |amount	                |amount_usd	            |vertical	                                |protocol                               |
      |ethereum	    |2024-11-23	|2024-11-23 23:26:47.000 UTC|0xbcd356bedca492c633d68ec9811eb8a95b19746fdea397ea36798dca0b997616	|stablecoin	    |0x039cf0cfb931a961692ff1a2b3379715aba3dd30	|0xfe3a7e584099a807a54ec3019ced5b0dcdc6bfe7	|EOA			| Transfer	    |USDC	|0xa0b86991c6218b36c1d19d4a2e9eb0ce3606eb48	|100	                |100.00   	            |unclassified transfer to EOA	            |unclassified transfer to EOA           |
      |ethereum	    |2024-11-23	|2024-11-23 15:42:59.000 UTC|0x2a5cc879685777e9c3b20bf6a890c6e5de6df1be02c4b39019592ff02e45c540	|stablecoin	    |0x4306fde5a11aa0a74ee006ccd1f4b5cf9a42ab25	|0xc83fcd23f73d6042ad1d3b2d5d85adfef573ce89	|Safe	        | Transfer	    |USDC	|0xa0b86991c6218b36c1d19d4a2e9eb0ce3606eb48	|150.25 	            |150.00         	    |unclassified transfer to Safe	            |Safe                                   |
      |ethereum	    |2024-11-23	|2024-11-23 13:23:47.000 UTC|0x45e5147bb5c3830678d1be205ddaa4a1753fcb75336a6295f404d67e28fef7cf	|erc20	        |0x24add7cf60090f2ca04a9b485728f5ef283386f8	|0xeca63b567ed4e279050756e58ec1b82126a87e81	|Safe	        | Transfer	    |PUSH	|0xf418588522d5dd018b425e472991e52ebbeeeeee	|1500	                |15500.00 	            |unclassified transfer to Safe	            |Safe                                   |
      |ethereum	    |2024-11-23	|2024-11-23 04:00:59.000 UTC|0xf1f08c7a3022885706761312ac67080a5e124125069169ec33973e922fe1ea83	|stablecoin	    |0xb347f1c353b528c29c337e27012497a08330bd8c	|0xe12dea0536b832d699c2d614c2610ac6de30fce6	|EOA			| Transfer	    |USDT	|0xdac17f958d2ee523a2206206994597c13d831ec7	|3600	                |3600.500	            |unclassified transfer to EOA	            |unclassified transfer to EOA           |
      |ethereum	    |2024-11-23	|2024-11-23 12:23:35.000 UTC|0x1b89112706eb08628ef57059486dad3cb056b4dcdeb04fba2f74373f80c1aec5	|stablecoin	    |0xbd4b515ed602792497364de7c306659297378fae	|0xd3735ecdd4e1bf062c7d9d169ad2fe8859491eb1	|EOA			| Transfer	    |USDT	|0xdac17f958d2ee523a2206206994597c13d831ec7	|750.500	            |750.5000 	            |unclassified transfer to EOA	            |unclassified transfer to EOA           |
      |ethereum	    |2024-11-23	|2024-11-23 13:08:11.000 UTC|0x5845b39d98f03e1277353ec7eb273597c840377867ff548140a538167fc93a82	|erc20	        |0xda495f89606d907c20a5b3e64c1b29093bdc7041	|0xbe7e6c2471fcf66ed186021ba329c10729cdf4ca	|EOA			| Transfer	    |wstETH	|0x7f39c581f595b53c5cb19bd0b3f8da6c935e2ca0	|1	                    |5000.00	            |unclassified transfer to EOA	            |unclassified transfer to EOA           |
      |ethereum	    |2024-11-23	|2024-11-23 19:24:11.000 UTC|0xb535433c2b9aa7cc0d7437b74793f24c3028cc4d44ed80cd7ca1bac1b17646a7	|erc20	        |0xda495f89606d907c20a5b3e64c1b29093bdc7041	|0xbe7e6c2471fcf66ed186021ba329c10729cdf4ca	|EOA			| Transfer	    |wstETH	|0x7f39c581f595b53c5cb19bd0b3f8da6c935e2ca0	|100	                |40000	                |unclassified transfer to EOA	            |unclassified transfer to EOA           |
      |ethereum	    |2024-11-23	|2024-11-23 07:18:23.000 UTC|0x47e7003df915fb04e73ff78f9c90d1def74094ea69656a6e37283501add8ef9b	|stablecoin	    |0x03310918833ce50b5aecf3246260cb29f7137d33	|0xbebe2e7be09fcd7ab1d412851f718533824df361	|EOA			| Transfer	    |DAI	|0x6b175474e89094c44da98b954eedeac495271d0f	|2000	                |100.500	            |unclassified transfer to EOA	            |unclassified transfer to EOA           |
      |ethereum	    |2024-11-23	|2024-11-23 19:25:59.000 UTC|0x277726002ed82fd04d4fa0d347f11a2e6e07652bfb1bd1adfeb234f4672d81c0	|erc20	        |0xda495f89606d907c20a5b3e64c1b29093bdc7041	|0xbe7e6c2471fcf66ed186021ba329c10729cdf4ca	|EOA			| Transfer	    |wstETH	|0x7f39c581f595b53c5cb19bd0b3f8da6c935e2ca0	|100.500	            |100.500	            |unclassified transfer to EOA	            |unclassified transfer to EOA           |
      |ethereum	    |2024-11-23	|2024-11-23 20:38:11.000 UTC|0xf000a9326e47f5b2fa12c6648d1f4e81855077cd3db43bc384dbd1f726f679ec	|erc20	        |0x6fa1dd28c591497f4b933fdd5f6893f191411741	|0x1bb7b4f7d98a9d204186b36d3852e28f3286f577	|EOA			| Transfer	    |RARE	|0xba5bde662c17e2adff1075610382b9b691296350	|450.500                |450.500	            |unclassified transfer to EOA	            |unclassified transfer to EOA           |
      |ethereum	    |2024-11-23	|2024-11-23 00:03:11.000 UTC|0x7e336c27aca333968c242e7bb21e165a0b69e005113421eb42badbc952849b7b	|erc20	        |0x56a6f4f1e758893e6276bf1ab291f4f338b7c367	|0xb1115903c3481644aef2a8977bfe49da9e28dc88	|Smart contract	| Transfer	    |USDe	|0x4c9edd5852cd905f086c759e8383e09bff1e68b3	|0.750          	    |0.750              	|unclassified transfer to Smart contract	|unclassified transfer to Smart contract|
      |ethereum	    |2024-11-23	|2024-11-23 00:03:11.000 UTC|0x7e336c27aca333968c242e7bb21e165a0b69e005113421eb42badbc952849b7b	|erc20	        |0x56a6f4f1e758893e6276bf1ab291f4f338b7c367	|0x979bcb1da482cdf26fab78578112ffe3526b9e91	|Smart contract	| Transfer	    |USDe	|0x4c9edd5852cd905f086c759e8383e09bff1e68b3	|0.250              	|0.250          	    |unclassified transfer to Smart contract	|unclassified transfer to Smart contract|
      |ethereum	    |2024-11-23	|2024-11-23 00:03:11.000 UTC|0x7e336c27aca333968c242e7bb21e165a0b69e005113421eb42badbc952849b7b	|erc20	        |0x56a6f4f1e758893e6276bf1ab291f4f338b7c367	|0xa1238d3c3743d88127cde9ae9365d6fb588df355	|Smart contract	| Transfer	    |USDe	|0x4c9edd5852cd905f086c759e8383e09bff1e68b3	|1.000                	|1.000                  |unclassified transfer to Smart contract	|unclassified transfer to Smart contract|
    And There is no data present in existing silver layer at path '/silver/eth_transfers_data_quarantined/year=2024/month=11/'
    When ingesting data into silver layer
    Then silver layer contains data at path '/silver/eth_transfers_data_quarantined/year=2024/month=11/*.parquet':
      |block_date|tx_hash	                                                        |token_category| event_name  |amount_usd |vertical	                                |protocol                               |week_of_month|week_of_year|
      |2024-11-23|0xbcd356bedca492c633d68ec9811eb8a95b19746fdea397ea36798dca0b997616|stablecoin	   | Transfer	 |100.00     |unclassified transfer to EOA	            |unclassified transfer to EOA           |4            |47          |
      |2024-11-23|0x2a5cc879685777e9c3b20bf6a890c6e5de6df1be02c4b39019592ff02e45c540|stablecoin	   | Transfer	 |150.00     |unclassified transfer to Safe	            |Safe                                   |4            |47          |
      |2024-11-23|0x45e5147bb5c3830678d1be205ddaa4a1753fcb75336a6295f404d67e28fef7cf|erc20	       | Transfer	 |15500.00   |unclassified transfer to Safe	            |Safe                                   |4            |47          |
      |2024-11-23|0xf1f08c7a3022885706761312ac67080a5e124125069169ec33973e922fe1ea83|stablecoin	   | Transfer	 |3600.500   |unclassified transfer to EOA	            |unclassified transfer to EOA           |4            |47          |
      |2024-11-23|0x1b89112706eb08628ef57059486dad3cb056b4dcdeb04fba2f74373f80c1aec5|stablecoin	   | Transfer	 |750.5000   |unclassified transfer to EOA	            |unclassified transfer to EOA           |4            |47          |
      |2024-11-23|0x5845b39d98f03e1277353ec7eb273597c840377867ff548140a538167fc93a82|erc20	       | Transfer	 |5000.00    |unclassified transfer to EOA	            |unclassified transfer to EOA           |4            |47          |
      |2024-11-23|0xb535433c2b9aa7cc0d7437b74793f24c3028cc4d44ed80cd7ca1bac1b17646a7|erc20	       | Transfer	 |40000	     |unclassified transfer to EOA	            |unclassified transfer to EOA           |4            |47          |
      |2024-11-23|0x47e7003df915fb04e73ff78f9c90d1def74094ea69656a6e37283501add8ef9b|stablecoin	   | Transfer	 |100.500    |unclassified transfer to EOA	            |unclassified transfer to EOA           |4            |47          |
      |2024-11-23|0x277726002ed82fd04d4fa0d347f11a2e6e07652bfb1bd1adfeb234f4672d81c0|erc20	       | Transfer	 |100.500    |unclassified transfer to EOA	            |unclassified transfer to EOA           |4            |47          |
      |2024-11-23|0xf000a9326e47f5b2fa12c6648d1f4e81855077cd3db43bc384dbd1f726f679ec|erc20	       | Transfer	 |450.500    |unclassified transfer to EOA	            |unclassified transfer to EOA           |4            |47          |
      |2024-11-23|0x7e336c27aca333968c242e7bb21e165a0b69e005113421eb42badbc952849b7b|erc20	       | Transfer	 |0.750      |unclassified transfer to Smart contract	|unclassified transfer to Smart contract|4            |47          |
      |2024-11-23|0x7e336c27aca333968c242e7bb21e165a0b69e005113421eb42badbc952849b7b|erc20	       | Transfer	 |0.250      |unclassified transfer to Smart contract	|unclassified transfer to Smart contract|4            |47          |
      |2024-11-23|0x7e336c27aca333968c242e7bb21e165a0b69e005113421eb42badbc952849b7b|erc20	       | Transfer	 |1.000      |unclassified transfer to Smart contract	|unclassified transfer to Smart contract|4            |47          |


